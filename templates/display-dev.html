{% extends "./layout.html" %}
{% block head %}
<section class="hero is-info">
    {% include "./messages.html" %}
    <div class="hero-body">
        {% include "./display-info.html" %}
    </div>
</section>
{% endblock %}
{% block content%}
<section class="section">
    <div class="container">
        <!-- USING FORMS IS DEPRECATED NEED TO BE CORRECTED ERROR-->
        <form method="POST" action="{% url 'externals_selected' domain=domain.domain %}">
            {% csrf_token %}
            <div class="field is-grouped">
                <div class="control">
                    <button id="start" class="button is-primary" type="submit"><span id="groupCheckBox"></span>&nbsp;Selected - Start Scan</button>
                </div>
                <p class="control">
                    <input class="input" id="zip_from" type="number" placeholder="Range from ZIP">
                </p>
                <p class="control">
                    <input class="input" id="zip_to" type="number" placeholder="to ZIP">
                </p>
                <div class="control">
                    <button id="select_range" class="button is-primary" type="button">Select range
                    </button>
                </div>
                <div class="control">
                    <div class="is-pulled-right">
                        <a class="button is-info"><input type="checkbox" id="checkAll">&nbsp;Check All</a>
                    </div>
                </div>
            </div>
            <table id="externals" class="display">
                <thead>
                    <tr>
                        <th style="max-width: 20px;word-wrap: break-word;">Select</th>
                        <th style="max-width: 50px;word-wrap: break-word;">External Domains</th>
                        <th style="max-width: 50px;word-wrap: break-word;">Suggested Name<sup>**</sup></th>
                        <th style="max-width: 50px;word-wrap: break-word;">Description</th>
                        <th style="max-width: 50px;word-wrap: break-word;">Keywords</th>
                        <th style="max-width: 20px;word-wrap: break-word;">ZIP</th>
                        <th style="max-width: 50px;word-wrap: break-word;">Filter local / global</th>
                    </tr>
                </thead>
                <tbody>
                    {% for external in domain.filtered_externals %}
                    <tr>
                        <td style="max-width: 50px;word-wrap: break-word;">
                            <label class="checkbox">
                                {% if external.fullscan %}
                                <input type="checkbox" name="selected" class="groupCheckBox" value="{{external.external_domain}}" checked disabled />
                                {% else %}
                                <input type="checkbox" name="selected" class="groupCheckBox" value="{{external.external_domain}}" />
                                {% endif %}
                            </label>
                        </td>
                        <td style="max-width: 50px;word-wrap: break-word;" id="external_domain">{{external.external_domain}}<br />(<a href="{{ external.url }}" target="_blank">{{external.url|truncatechars_html:50}}</a>)
                        </td>
                        <td style="max-width: 50px;word-wrap: break-word;" id="name_id_{{ forloop.counter }}" style="width='100%'">
                            {% if external.info.misc %}
                            <b>
                                <div id="displayEditable">
                                    {{ external.info.misc }}
                                </div>
                            </b>&nbsp;({{ external.info.tip }})
                            {% else %}
                            <div id="displayEditable">-</div>
                            {% endif %}
                            <div id="openEdit" hidden>
                                <form method="POST" action="/edit/{{domain.domain}}/name/{{external.external_domain}}">
                                    {% csrf_token %}
                                    <textarea class="textarea" name="edit_name" style="width='100%'" id="edit" disabled />{{external.info.name}}</textarea>
                                    <div id="submitButton" hidden>
                                        <button class="button" type="submit">Save</button>
                                    </div>
                                </form>
                            </div>
                        </td>
                        <td style="max-width: 50px;word-wrap: break-word;">
                            {% if external.info.desc %}
                            {{ external.info.desc }}
                            {% else %}
                            -
                            {% endif %}
                        </td>
                        <td style="max-width: 50px;word-wrap: break-word;">
                            {% if external.info.keywords %}
                            {{ external.info.keywords }}
                            {% else %}
                            -
                            {% endif %}
                        </td>
                        <td id="zip" style="max-width: 50px;word-wrap: break-word;">
                            <div id="displayEditable">{{external.info.zip}}</div>
                            <div id="openEdit" hidden>
                                <form method="POST" action="/edit/{{domain.domain}}/zip/{{external.external_domain}}">
                                    {% csrf_token %}
                                    <input name="edit_zip" id="edit" class="input" size="5" type="number" value="{{external.info.zip}}" style="width='100%'"  disabled/>
                                    <input type="submit" hidden />
                                </form>
                            </div>
                        </td>
                        <td style="max-width: 50px;word-wrap: break-word;">
                            <div class="field is-grouped">
                                <p class="control">
                                    <a class="button is-warning is-outlined is-small" href="{% url 'add_to_localfilter' domain=domain.domain local_ignore=external.external_domain %}">local</a>
                                </p>
                                <p class="control">
                                    <a class="button is-danger is-outlined is-small" href="{% url 'filter' src_domain=domain.domain external_domain=external.external_domain %}">global</a>
                                </p>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </form>
    </div>
</section>
{% endblock %}
{% block javascript %}
{% load static %}
<script src="{% static '/js/regios-display.js' %}"></script>
{% endblock %}